clear all
clc

syms z e h t L H k w m Cp
Tr=sym('Tr',[4 1]);
Tf=sym('Tf',[2 1]);
Tl=sym('Tl',[4 1]);
format compact
format rat
C=[0 0;L 0; L H;0 H];
N1=((1-z).*(1-e))/4;
N2=((1+z).*(1-e))/4;
N3=((1+z).*(1+e))/4;
N4=((1-z).*(1+e))/4;
N7=((1-z).*(1-e))/4;
N8=((1+z).*(1-e))/4;
N9=((1+z).*(1+e))/4;
N10=((1-z).*(1+e))/4;
N5=(1-z)/2; N6=(1+z)/2;
N=[N1 N2 N3 N4];
NF=[N5 N6];

%% Differentiation
%%
dN=[diff(N,z); diff(N,e)];
dNF=diff(NF,z);

%% 
%% Equation 1
%%
K=0;
F=0;
for i =1:4
    if i==1
        z=-1/sqrt(3);
        e=-1/sqrt(3);
    elseif i==2
        z=1/sqrt(3);
        e=-1/sqrt(3);
    elseif i==3
        z=1/sqrt(3);
        e=1/sqrt(3);
    elseif i==4
        z=-1/sqrt(3);
        e=1/sqrt(3);
    end
    
    
    Ni=double(subs(dN));
    Ji=Ni*C;
    Ji=simplify((subs(Ji)));
    Bi=Ji\Ni;
    Ki=transpose(Bi)*Bi*det(Ji);
    K=K+Ki;
    
    Nc=double(subs(N));
    Fi=Nc*det(Ji);
    F=F+Fi;
    
end
K=simplify(subs(K));
F=simplify(subs(F));
S1=[(k.*K)+((h.*F)/(4.*t)) 0 0 0 0 0 0;0 0 0 0 -(h/2.*t).*sum(F) 0 0 0 0 0;0 0 0 0 0 -(h/2.*t).*sum(F) 0 0 0 0; 0 0 0 0 0 0 (k.*K)+((h.*F)/(4.*t))];
%% Equation 2
%%
Kf=0;
Pf=0;
for j=1:2
    if j==1
        z=-1/sqrt(3);
    elseif j==2
        z=1/sqrt(3);
    end
    NFj=double(subs(NF));
    dNFj=double(subs(dNF));
    Jj=dNFj*[0; L];
    Bj=dNFj/Jj;
    Kfi=transpose(NFj)*Bj*det(Jj);
    Kf=Kf+Kfi ;
    
    Pj=NFj*[0;L];
    Pf=Pj+Pf;
end
Kf;
Pf;
U=-h.*H.*Pf/4;
W=-h.*w.*Pf/4;
S2=[U+W U+W 0 0 0 0 0 0 0 0;U+W U+W 0 0 0 0 0 0 0 0;0 0 U U 0 0 0 0 0 0;0 0 U U 0 0 0 0 0 0;0 0 0 0 (-2*(U+U+W)),(-2*(U+U+W)) 0 0 0 0;0 0 0 0 (-2*(U+U+W))+m*Cp,(-2*(U+U+W))-m*Cp 0 0 0 0;0 0 0 0 0 0 U+W U+W 0 0;0 0 0 0 0 0 U+W U+W 0 0;0 0 0 0 0 0 0 0 U U;0 0 0 0 0 0 0 0 U U];
S=simplify(S1+S2);
S_2=[S(1,1) S(1,2) S(1,3) S(1,4) 0 0 0 0 0 0 0 0 0 0 0;S(2,1) S(2,2)+S(1,1) S(2,3)+S(1,4) S(2,4) 0 0 0 0 0 0 S(3,4) S(4,2) 0 0 0; S(3,1) S(3,2)+S(4,1) S(3,3)+S(4,4) S(3,4) 0 0 0 0 0 0 S(1,3) S(1,1) 0 0 0;S(4,1) S(4,2) S(4,3) S(4,4) 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 S(5,5) S(5,6) 0 0 0 0 0 0 0 0 0; 0 0 0 0 S(6,5) S(6,6)+S(5,5) 0 0 0 0 0 0 S(5,6) 0 0;0 0 0 0 0 0 S(7,7) S(7,8) S(7,9) S(7,10) 0 0 0 0 0;0 0 0 0 0 0 S(8,7) S(8,8)+S(7,7) S(8,9)+S(7,10) S(8,10) 0 0 0 S(8,7) S(9,7);0 0 0 0 0 0 S(9,7) S(9,8)+S(7,10) S(9,9)+S(10,10) S(9,10) 0 0 0 S(8,10) S(9,10);0 0 0 0 0 0 S(10,7) S(10,8) S(10,9) S(10,10) 0 0 0 0 0;0 S(3,4) S(3,1) 0 0 0 0 0 0 0 S(3,3) S(2,3) 0 0 0;0 S(4,2) S(2,1) 0 0 0 0 0 0 0 S(2,3) S(2,2) 0 0 0;0 0 0 0 0 S(5,6) 0 0 0 0 0 0 S(6,6) 0 0;0 0 0 0 0 0 0 S(7,8) S(8,10) 0 0 0 0 S(8,8) S(9,8);0 0 0 0 0 0 0 S(7,9) S(9,10) 0 0 0 0 S(9,8) S(9,9)];
%% Substituting values
%%
format short
prompt = 'Enter the number of elements (1 or 2) ';
n = input(prompt);
L=0.05/n;
H=200*1e-06;
w=56*1e-06;
t=12*1e-06;
h=54290;
Cp=4.180;
k=0.609;
m=2.21*1e-05;
S=simplify(S1+S2); 
S=double(subs(S));
S_2=double(subs(S_2));
if n==1
   S(3,:)=[];   S(3,:)=[];  S(3,:)=[];  S(6,:)=[];  S(6,:) = [];
   S(:,3)=[];   S(:,3)=[];  S(:,3)=[];  S(:,6)=[];  S(:,6)=[]; 
    S
    B=(10^5).*[1;1;1;1;1];
    T=S\B;
    Tsur=(T(1,1)+T(2,1)+T(4,1)+T(5,1))
else
%     S_2=[S(1,1) S(1,2) S(1,3) S(1,4) 0 0 0 0 0 0 0 0 0 0 0;S(2,1) S(2,2)+S(1,1) S(2,3)+S(1,4) S(2,4) 0 0 0 0 0 0 S(3,4) S(4,2) 0 0 0; S(3,1) S(3,2)+S(4,1) S(3,3)+S(4,4) S(3,4) 0 0 0 0 0 0 S(1,3) S(1,1) 0 0 0;S(4,1) S(4,2) S(4,3) S(4,4) 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 S(5,5) S(5,6) 0 0 0 0 0 0 0 0 0; 0 0 0 0 S(6,5) S(6,6)+S(5,5) 0 0 0 0 0 0 S(5,6) 0 0;0 0 0 0 0 0 S(7,7) S(7,8) S(7,9) S(7,10) 0 0 0 0 0;0 0 0 0 0 0 S(8,7) S(8,8)+S(7,7) S(8,9)+S(7,10) S(8,10) 0 0 0 S(8,7) S(9,7);0 0 0 0 0 0 S(9,7) S(9,8)+S(7,10) S(9,9)+S(10,10) S(9,10) 0 0 0 S(8,10) S(9,10);0 0 0 0 0 0 S(10,7) S(10,8) S(10,9) S(10,10) 0 0 0 0 0;0 S(3,4) S(3,1) 0 0 0 0 0 0 0 S(3,3) S(2,3) 0 0 0;0 S(4,2) S(2,1) 0 0 0 0 0 0 0 S(2,3) S(2,2) 0 0 0;0 0 0 0 0 S(5,6) 0 0 0 0 0 0 S(6,6) 0 0;0 0 0 0 0 0 0 S(7,8) S(8,10) 0 0 0 0 S(8,8) S(9,8);0 0 0 0 0 0 0 S(7,9) S(9,10) 0 0 0 0 S(9,8) S(9,9)];
    S_2(5,:)=[];
    S_2(:,5)=[];
    B_2=(10^6/15).*[1;2;2;1;1;2;1;2;2;1;1;1;1;1;1];
    B_2(5,:)=[];
    T_2=S_2\B_2;
    Tsur=(T_2(4,1)+T_2(10,1)+T_2(13,1)+T_2(6,1)+T_2(3,1)+T_2(7,1))/3
    
end